<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ASVAB 学习指南（MVP）</title>
  <meta name="description" content="ASVAB 学习指南：AR、MK、WK/PC、GS 核心要点与练习，小测题库支持随机抽题、只看错题和导出错题。">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>

    <!-- 放到 index.html 的页眉区域 -->
    <div style="margin-left:auto; display:flex; gap:12px; align-items:center;">
      <span id="whoami" class="small" style="opacity:.8"></span>
      <a id="loginBtn"  href="auth.html" class="btn" style="padding:.45rem .8rem;border-radius:.5rem;border:1px solid #334155;color:#e5e7eb;text-decoration:none;">登录</a>
      <button id="logoutBtn" class="btn" style="display:none;padding:.45rem .8rem;border-radius:.5rem;border:1px solid #334155;background:#1f2937;color:#e5e7eb;">退出</button>
    </div>

    <div class="wrap" style="display:flex; align-items:center; justify-content:space-between;">
      <div style="font-weight:600;">ASVAB 学习指南 <small style="color:#67e8f9;">MVP</small></div>
      <nav>
        <a href="#sections">考试模块</a>
        <a href="#tips">高频考点</a>
        <a href="#plan">备考计划</a>
        <a href="about.html">关于</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <h1>从这里开始准备 ASVAB</h1>
      <p>这是首发版网站的首页。下面四个模块分别对应主要考试科目，点击可进入详情。</p>
    </section>

    <section id="sections" class="wrap">
        <section class="wrap">
            <div class="card" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
              <div>
                <h3 style="margin:0 0 6px;">学前测试</h3>
                <p class="small" style="margin:0;">AR MK完整试题、自动判分、只看错题、导出错题。</p>
              </div>
              <a class="btn" href="quiz.html">开始练习</a>
            </div>
          </section>
          
      <h2>考试模块一览</h2>
      <div class="grid">
        <div class="card">
          <h3>AR 算术推理</h3>
          <p>速算、比例、单位换算与应用题阅读。</p>
          <a class="btn" href="ar.html">查看要点</a>
        </div>
        <div class="card">
          <h3>MK 数学知识</h3>
          <p>代数基础、方程不等式、百分比与几何初步。</p>
          <a class="btn" href="mk.html">查看要点</a>
        </div>
        <div class="card">
          <h3>WK & PC 词汇与阅读</h3>
          <p>词根词缀、近义反义、一段短文主旨。</p>
          <a class="btn" href="wk-pc.html">查看要点</a>
        </div>
        <div class="card">
          <h3>GS 自然科学</h3>
          <p>生物/化学/物理常识与日常应用。</p>
          <a class="btn" href="gs.html">查看要点</a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>© <span id="y"></span> ASVAB 学习指南 • 仅供授权学生使用</p>
  </footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>

<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  // TODO: 替换成你自己的 Supabase 值
  const supabase = createClient("https://tsximmhtxysoeabxwlkv.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRzeGltbWh0eHlzb2VhYnh3bGt2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MDA2MTcsImV4cCI6MjA3NjM3NjYxN30.PQ0Fldv-vl4o_LH9niy2IbJwhcrCPbsaEM7sLEgXf8U");

  const whoami   = document.getElementById('whoami');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn= document.getElementById('logoutBtn');

  async function refreshAuthUI() {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) {
      // 未登录
      whoami.textContent = '';
      loginBtn.style.display  = 'inline-block';
      logoutBtn.style.display = 'none';
      return;
    }
    // 已登录 → 显示姓名
    const uid = session.user.id;
    const { data:profile } = await supabase.from('profiles')
      .select('full_name').eq('id', uid).maybeSingle();
    const name = profile?.full_name || localStorage.getItem('asvab_student_name') || session.user.email;
    whoami.textContent = `学员：${name}`;
    loginBtn.style.display  = 'none';
    logoutBtn.style.display = 'inline-block';
  }

  // 退出按钮
  logoutBtn?.addEventListener('click', async () => {
    await supabase.auth.signOut();
    await refreshAuthUI();
  });

  // 进入页面先刷新一次
  refreshAuthUI();

  // （可选）如果首页有 “开始练习 / 去做题” 之类的按钮，确保未登录时先去登录页：
  document.querySelectorAll('a[href="quiz.html"], a[data-go-quiz]').forEach(a => {
    a.addEventListener('click', async (e) => {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) { e.preventDefault(); location.href = 'auth.html'; }
    });
  });
</script>

</body>
</html>
