cat > quiz.html <<'EOF'
<!doctype html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ASVAB å°æµ‹ï¼ˆAR / MK / WK / GSï¼‰Â· å­¦ä¹ æŒ‡å—</title>
  <meta name="description" content="ASVAB å°æµ‹ï¼šæ”¯æŒ ARã€MKã€WK/PCã€GSï¼ŒéšæœºæŠ½é¢˜ï¼Œè‡ªåŠ¨åˆ¤åˆ†ã€åªçœ‹é”™é¢˜ã€å¯¼å‡ºé”™é¢˜ JSONã€‚">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;">
      <div style="font-weight:600;"><a href="/" style="color:#e5e7eb;text-decoration:none;">ASVAB å­¦ä¹ æŒ‡å—</a></div>
      <nav>
        <a href="/">é¦–é¡µ</a>
        <a href="about.html">å…³äº</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <h1>ASVAB å°æµ‹</h1>
    <div class="card" style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;">
      <label>æ¨¡å—ï¼š
        <select id="module">
          <option value="AR">AR ç®—æœ¯æ¨ç†</option>
          <option value="MK">MK æ•°å­¦çŸ¥è¯†</option>
          <option value="WK">WK / PC è¯æ±‡ä¸é˜…è¯»</option>
          <option value="GS">GS è‡ªç„¶ç§‘å­¦</option>
        </select>
      </label>
      <label>é¢˜é‡ï¼š
        <select id="count">
          <option value="5">5</option>
          <option value="10">10</option>
        </select>
      </label>
      <!-- å…œåº•ï¼šç›´æ¥åœ¨æŒ‰é’®ä¸Šç»‘å®š onclick -->
      <button id="gen" class="btn" onclick="generate()">ç”Ÿæˆè¯•å·</button>
      <a class="btn" href="/" style="margin-left:auto;">å›é¦–é¡µ</a>
    </div>

    <div class="card small" style="margin-top:8px;">ğŸŸ¡ æç¤ºï¼šå¦‚æœçœ‹ä¸åˆ°é¢˜ç›®ï¼Œç¡®è®¤ä½ è®¿é—®çš„æ˜¯ <b>/quiz.html</b>ï¼Œä¸æ˜¯ <b>/quiz.js</b>ã€‚å¯å°è¯•å¼ºåˆ¶åˆ·æ–°ï¼ˆMac: Cmd+Shift+R / Win: Ctrl+F5ï¼‰ã€‚</div>

    <div id="quiz"></div>

    <div class="card" id="actions" style="display:none;gap:12px;align-items:center;margin-top:16px;">
      <button id="submit" class="btn">æäº¤ç­”æ¡ˆ</button>
      <button id="toggleWrong" class="btn" style="display:none;">åªçœ‹é”™é¢˜</button>
      <button id="exportWrong" class="btn" style="display:none;">å¯¼å‡ºé”™é¢˜ JSON</button>
      <button id="retry" class="btn" style="display:none;" onclick="generate()">é‡æŠ½ä¸€å¥—</button>
    </div>

    <div class="card" id="result" style="display:none;margin-top:16px;"></div>
  </main>

  <footer>
    <p>Â© <span id="y"></span> ASVAB å­¦ä¹ æŒ‡å—</p>
  </footer>

  <script>
  document.getElementById('y').textContent = new Date().getFullYear();

  // é¢˜åº“
  const BANK = [
    // AR
    { m:'AR', q:"ä¸€ä»¶å•†å“æ‰“å…«æŠ˜åæ˜¯ $56ï¼ŒåŸä»·æ˜¯å¤šå°‘ï¼Ÿ", c:["$64","$68","$70","$72"], a:2, e:"å…«æŠ˜=0.8ï¼›åŸä»·=56/0.8=70ã€‚" },
    { m:'AR', q:"3 å°æ—¶è¡Œé©¶ 180 è‹±é‡Œï¼Œå¹³å‡é€Ÿåº¦ï¼Ÿ", c:["50 mph","55 mph","60 mph","65 mph"], a:2, e:"180/3=60 mphã€‚" },
    { m:'AR', q:"1 åŠ ä»‘=4 å¤¸è„±ã€‚5 å¤¸è„±ç­‰äºå‡ åŠ ä»‘ï¼Ÿ", c:["1.0","1.25","1.5","2.0"], a:1, e:"5Ã·4=1.25 åŠ ä»‘ã€‚" },
    { m:'AR', q:"ä»·æ ¼ä» $40 æ¶¨åˆ° $50ï¼Œæ¶¨å¹…ç™¾åˆ†æ¯”ï¼Ÿ", c:["20%","22%","25%","28%"], a:2, e:"(50-40)/40=25%ã€‚" },
    { m:'AR', q:"é•¿ 12 å®½ 8 çš„çŸ©å½¢é¢ç§¯ï¼Ÿ", c:["80","88","92","96"], a:3, e:"12Ã—8=96ã€‚" },
    // MK
    { m:'MK', q:"è‹¥ 2x + 6 = 18ï¼Œåˆ™ x = ï¼Ÿ", c:["4","5","6","7"], a:2, e:"2x=12â†’x=6ã€‚" },
    { m:'MK', q:"ä¸‰è§’å½¢é¢ç§¯å…¬å¼ï¼Ÿ", c:["bh","Ï€rÂ²","1/2Â·bh","2Ï€r"], a:2, e:"é¢ç§¯=Â½Â·åº•Â·é«˜ã€‚" },
    { m:'MK', q:"25% ç­‰äºï¼Ÿ", c:["1/2","1/3","1/4","1/5"], a:2, e:"25%=1/4ã€‚" },
    { m:'MK', q:"åœ†çš„å‘¨é•¿å…¬å¼ï¼Ÿ", c:["2Ï€r","Ï€rÂ²","rÂ²/2","Ï€/2"], a:0, e:"C=2Ï€rã€‚" },
    { m:'MK', q:"5x-15=0ï¼Œx=?", c:["-3","0","3","15"], a:2, e:"x=15/5=3ã€‚" },
    // WK / PC
    { m:'WK', q:"'benevolent' çš„æ„æ€æ˜¯ï¼Ÿ", c:["æ¶æ„çš„","å‹å–„çš„","æ‡’æƒ°çš„","å†·æ¼ çš„"], a:1, e:"bene- è¡¨ç¤ºâ€œå¥½â€ï¼Œbenevolent=å–„è‰¯çš„ã€‚" },
    { m:'WK', q:"'antonym' æ„æ€æ˜¯ï¼Ÿ", c:["åŒä¹‰è¯","åä¹‰è¯","åè¯","å½¢å®¹è¯"], a:1, e:"antonym = opposite meaningã€‚" },
    { m:'WK', q:"'The sun dipped below the horizon' çš„å«ä¹‰æ˜¯ï¼Ÿ", c:["å¤ªé˜³å‡èµ·","å¤ªé˜³ä¸‹å±±","å¤©æ°”ç‚çƒ­","å¤œæ™šæ¥ä¸´"], a:1, e:"dipped below horizon = ä¸‹å±±ã€‚" },
    { m:'WK', q:"è¯æ ¹ 'bio' çš„å«ä¹‰ï¼Ÿ", c:["ç”Ÿå‘½","æ—¶é—´","åœ°çƒ","å£°éŸ³"], a:0, e:"bio = lifeã€‚" },
    { m:'WK', q:"'reluctant' çš„æ„æ€ï¼Ÿ", c:["æ¸´æœ›çš„","å®³æ€•çš„","ä¸æƒ…æ„¿çš„","å…´å¥‹çš„"], a:2, e:"reluctant = unwillingã€‚" },
    // GS
    { m:'GS', q:"æ°´çš„åŒ–å­¦å¼ï¼Ÿ", c:["Hâ‚‚O","COâ‚‚","Oâ‚‚","NaCl"], a:0, e:"æ°´ = Hâ‚‚Oã€‚" },
    { m:'GS', q:"åœ°çƒç»•å¤ªé˜³ä¸€åœˆçº¦ï¼Ÿ", c:["1 å¤©","1 å‘¨","1 æœˆ","1 å¹´"], a:3, e:"çº¦ 1 å¹´ã€‚" },
    { m:'GS', q:"å‘¼å¸ç³»ç»Ÿä¸»è¦å™¨å®˜ï¼Ÿ", c:["å¿ƒè„","è‚º","è‚¾","èƒƒ"], a:1, e:"è‚ºè´Ÿè´£æ°”ä½“äº¤æ¢ã€‚" },
    { m:'GS', q:"æ¤ç‰©åˆ¶é€ é£Ÿç‰©çš„è¿‡ç¨‹ï¼Ÿ", c:["æ¶ˆåŒ–","å…‰åˆä½œç”¨","è’¸å‘","æ°§åŒ–"], a:1, e:"å…‰åˆä½œç”¨ã€‚" },
    { m:'GS', q:"èƒ½é‡å•ä½ï¼Ÿ", c:["ç±³","ç„¦è€³","å‡","å…‹"], a:1, e:"Jï¼ˆç„¦è€³ï¼‰ã€‚" },
  ];

  // å·¥å…·
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;}
  function sample(arr,n){return shuffle([...arr]).slice(0,n);}

  // çŠ¶æ€
  let picked=[], onlyWrong=false, wrongList=[];

  // æ¸²æŸ“
  function renderQuiz() {
  const quiz = document.getElementById('quiz');
  quiz.innerHTML = picked.map((item, idx) => {
    const name = `q${idx}`;
    const choices = item.c.map((t, i) => `
      <label style="display:block;margin:6px 0;">
        <input type="radio" name="${name}" value="${i}"> ${String.fromCharCode(65 + i)}. ${t}
      </label>
    `).join('');
    return `
      <div class="card" data-idx="${idx}">
        <div style="font-weight:600;margin-bottom:6px;">${idx + 1}. ${item.q}</div>
        <div>${choices}</div>
        <div id="exp-${idx}" class="small" style="display:none;margin-top:8px;"></div>
      </div>
    `;
  }).join('');

  document.getElementById('actions').style.display = 'flex';
  document.getElementById('result').style.display = 'none';
  document.getElementById('toggleWrong').style.display = 'none';
  document.getElementById('exportWrong').style.display = 'none';
  document.getElementById('retry').style.display = 'none';
  onlyWrong = false;
}


  // æ ¸å¿ƒå‡½æ•°ï¼ˆæŒ‰é’® onclick ä¹Ÿä¼šè°ƒç”¨å®ƒï¼‰
  function generate(){
    const mod=document.getElementById('module').value;
    const cnt=Number(document.getElementById('count').value);
    const pool=BANK.filter(x=>x.m===mod);
    picked=sample(pool,Math.min(cnt,pool.length));
    wrongList=[];
    renderQuiz();
  }
  window.generate = generate; // æš´éœ²åˆ°å…¨å±€ç»™ onclick ç”¨

  // äº‹ä»¶
  // äº‹ä»¶
document.getElementById('submit').addEventListener('click', () => {
  let score = 0;
  wrongList = [];
  picked.forEach((item, idx) => {
    const chosen = document.querySelector(`input[name="q${idx}"]:checked`);
    const exp = document.getElementById(`exp-${idx}`);
    const user = chosen ? Number(chosen.value) : -1;
    const ok = user === item.a;
    if (ok) score++; else wrongList.push({ ...item, user });
    exp.style.display = 'block';
    exp.innerHTML = ok
      ? `âœ… æ­£ç¡®ï¼š${String.fromCharCode(65 + item.a)}ã€‚${item.e}`
      : `âŒ ä½ çš„ç­”æ¡ˆï¼š${user >= 0 ? String.fromCharCode(65 + user) : "æœªä½œç­”"}ï¼›æ­£ç¡®ï¼š${String.fromCharCode(65 + item.a)}ã€‚${item.e}`;
  });

  const result = document.getElementById('result');
  result.style.display = 'block';
  result.innerHTML = `<b>å¾—åˆ†ï¼š${score}/${picked.length}</b> Â· æ­£ç¡®ç‡ ${(score / picked.length * 100).toFixed(0)}%`;

  document.getElementById('toggleWrong').style.display = 'inline-block';
  document.getElementById('exportWrong').style.display = wrongList.length ? 'inline-block' : 'none';
  document.getElementById('retry').style.display = 'inline-block';
});

document.getElementById('toggleWrong').addEventListener('click', () => {
  onlyWrong = !onlyWrong;
  picked.forEach((_, idx) => {
    const card = document.querySelector(`.card[data-idx="${idx}"]`);
    const isWrong = wrongList.some(w => w.q === picked[idx].q);
    card.style.display = (onlyWrong && !isWrong) ? 'none' : 'block';
  });
  document.getElementById('toggleWrong').textContent = onlyWrong ? 'æ˜¾ç¤ºå…¨éƒ¨' : 'åªçœ‹é”™é¢˜';
});

document.getElementById('exportWrong').addEventListener('click', () => {
  const data = wrongList.map(w => ({
    module: w.m,
    question: w.q,
    choices: w.c,
    correctIndex: w.a,
    userIndex: w.user,
    explanation: w.e
  }));
  const blob = new Blob(
    [JSON.stringify({ exportedAt: new Date().toISOString(), items: data }, null, 2)],
    { type: 'application/json' }
  );
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'asvab_wrong_questions.json';
  a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('retry').addEventListener('click', generate);


  // é¡µé¢è½½å…¥æ—¶å…ˆç”Ÿæˆä¸€å¥—é»˜è®¤é¢˜
  generate();
  </script>
</body>
</html>
EOF
